node {
    stage("Git Clone"){

        git credentialsId: 'Github-Access', url: 'https://github.com/karblackstraw/jenkins-springboot-app.git'
    }

     stage('Gradle Build') {

       sh './gradlew build'

    }

    stage("Docker build"){
        sh 'docker version'
        sh 'docker build -t springboot-demo .'
        sh 'docker image list'
        sh 'docker tag springboot-demo karblackstraw/zaarans:springboot-demo'
    }

    withCredentials([string(credentialsId: 'DOCKER_HUB_PASSWORD', variable: 'PASSWORD')]) {
        sh 'docker login -u karblackstraw -p $PASSWORD'
    }

    stage("Push Image to Docker Hub"){
        sh 'docker push  karblackstraw/zaarans:springboot-demo'
    }

    stage("Deploy to Kubernetes") {
        script{
            def namespace = "nswordpress"
        }
        withCredentials([file(credentialsId: 'KUBERNETES-ID-PRAVEEN', variable: 'kubecfg')]){
            sh "kubectl config set-context $(kubectl config current-context) --namespace=${namespace}"
        }
                    
        stage('Put k8s-spring-boot-deployment.yml onto k8smaster') {
            sh 'k8s-spring-boot-deployment.yml', into: '.'
        }

        stage('Deploy spring boot') {
          sh "kubectl apply -f k8s-spring-boot-deployment.yml"
        //   kubectl apply -f file.yaml --kubeconfig=/path_to_config_file
        }
    }

}  