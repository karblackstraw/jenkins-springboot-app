pipeline {
    agent any
    stages{
        stage('git clone'){
            steps{
                git credentialsId: 'Github-Access', url: 'https://github.com/karblackstraw/jenkins-springboot-app.git'       
            }
        }  
        stage('Gradle Build'){
            steps{
                sh './gradlew build'
            }   
        }
        stage('Docker Build'){
            steps{
                sh 'docker version'
                sh 'docker build -t springboot-demo .'
                sh 'docker image list'
                sh 'docker tag springboot-demo karblackstraw/zaarans:springboot-demo'
            }
        }
        stage('Dockerhub LogIn'){
             steps{
                withCredentials([string(credentialsId: 'DOCKER_HUB_PASSWORD', variable: 'PASSWORD')]) {
                sh 'docker login -u karblackstraw -p $PASSWORD'
                }
            }
        }
        stage("Push Image to Docker Hub"){
            steps{
                sh 'docker push  karblackstraw/zaarans:springboot-demo'
            }    
        }
        stage('Build Number'){
            steps{
                echo "Running ${env.BUILD_ID} on ${env.JENKINS_URL}"
            }
        }
        stage('Deploy Springboot'){
            environment{
                MY_KUBECONFIG = credentials('KUBERNETES-ID-PRAVEEN')
            }
            steps{
                sh 'kubectl --kubeconfig ${MY_KUBECONFIG} get pods'
                sh 'kubectl --kubeconfig ${MY_KUBECONFIG} apply -f k8s-spring-boot-deployment.yml'
            }
        }
    }      
}      